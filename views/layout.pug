extends ./head

block body
  script(src="/javascripts/layouts/layout.js")

  .topbar
    img.logo(src="/assets/logos/logo.svg" onclick="location.href='/'")
    #topbar-links
      a(href='/') Home
        .underline
      a(href='/awards') Awards
        .underline
      a(href='/leaderboards') Leaderboards
        .underline
      a(href='/settings' style=`display: ${displays.loggedIn.true.flex}`) Settings
        .underline
      a(href=`/profile/${user.id}` style=`display: ${displays.loggedIn.true.flex}`) Profile
        .underline
      a.search-link(href=`/search`) Search
        .underline
      a(href=`/admin` style=`display: ${displays.permission.any.flex}`) Admin
        .underline
      script.
        const path = location.pathname
        let selectedLink

        if (path === "/") {
          selectedLink = 0
        } else if (path === "/awards") {
          selectedLink = 1
        } else if (path === "/leaderboards") {
          selectedLink = 2
        } else if (path === "/settings") {
          selectedLink = 3
        } else if (path === "/search") {
          selectedLink = 5
        } else if (path === "/admin") {
          selectedLink = 6
        } else if (isLoggedIn()) {
          const parts = path.split("/")
          if (parts[1] === "profile" && parts[2] == #{user.id} && (parts[3] == null || parts[3].length === 0)) selectedLink = 4
        }

        if (selectedLink != null) byId("topbar-links").children[selectedLink].classList.add("selected")

    .search
      #search-icon.material-icons search
      .vertical-line
      input#search-input(type='text' placeholder='Search..')

    a.sign-in.signin-link(style=`display: ${displays.loggedIn.false.block}`) Sign In
    .account-display(onclick=`location.href="/profile/${user.id}"` style=`display: ${displays.loggedIn.true.flex}`)
      img(src=user.profilePicture)
      div
        p.name= user.fullName
        p.email= user.email

    #sidebar-icon.hamburger-icon
      div
      div
      div

  .topbar-spacer

  #sidebar
    a(href="/") Home
    a(href="/awards") Awards
    a(href="/leaderboards") Leaderboards
    a(href="/search") Search
    a(href="/settings") Settings
    a(href=`/profile/${user.id}` style=`display: ${displays.loggedIn.true.block}`) Profile
    a(href=`/admin` style=`display: ${displays.permission.any.flex}`) Admin
    a.signin-link(style=`display: ${displays.loggedIn.false.block}`) Sign In
    button#logout-button(style=`display: ${displays.loggedIn.true.block}`) Sign Out

  .content-block-container
    block content

  footer
    p.a &copy 2023 <a href="/">TOPAL</a>
    a.treverton-link(href="https://www.treverton.co.za" target="_blank") TREVERTON

  block script